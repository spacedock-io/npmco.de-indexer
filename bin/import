#!/usr/bin/env node
var zlib = require('zlib'),
    tar = require('tar'),
    request = require('request'),
    Importer = require('../lib/import'),
    elasticstream = require('elasticstream');

var package = process.argv[2].split('@'),
    name = package[0],
    version = package[1];

request({
  url: 'https://registry.npmjs.org/' + name,
  json: true
}, function (err, res, body) {
  if (err) throw err;
  if (!body.versions[version]) throw new Error('No such version');

  request(body.versions[version].dist.tarball)
    .pipe(zlib.createGunzip())
    .pipe(tar.Parse())
    .pipe(Importer({ name: name, version: version }))
    .pipe(elasticstream({ index: 'files', type: 'file' }));
});
